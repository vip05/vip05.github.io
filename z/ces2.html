<!doctype html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>ä»£ç†ç»‘å®šç³»ç»Ÿ</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				display: flex;
				justify-content: center;
				align-items: center;
				padding: 20px;
			}

			.container {
				background: white;
				border-radius: 20px;
				box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
				padding: 40px;
				max-width: 500px;
				width: 100%;
			}

			h1 {
				color: #333;
				margin-bottom: 10px;
				font-size: 28px;
			}

			.subtitle {
				color: #666;
				margin-bottom: 30px;
				font-size: 14px;
			}

			.form-group {
				margin-bottom: 20px;
			}

			label {
				display: block;
				color: #555;
				font-weight: 600;
				margin-bottom: 8px;
				font-size: 14px;
			}

			input {
				width: 100%;
				padding: 12px 15px;
				border: 2px solid #e0e0e0;
				border-radius: 10px;
				font-size: 15px;
				transition: all 0.3s;
			}

			input:focus {
				outline: none;
				border-color: #667eea;
				box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
			}

			button {
				width: 100%;
				padding: 14px;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				border: none;
				border-radius: 10px;
				font-size: 16px;
				font-weight: 600;
				cursor: pointer;
				transition:
					transform 0.2s,
					box-shadow 0.2s;
			}

			button:hover {
				transform: translateY(-2px);
				box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
			}

			button:active {
				transform: translateY(0);
			}

			button:disabled {
				opacity: 0.6;
				cursor: not-allowed;
			}

			.result {
				margin-top: 20px;
				padding: 15px;
				border-radius: 10px;
				display: none;
			}

			.result.success {
				background: #d4edda;
				color: #155724;
				border: 1px solid #c3e6cb;
			}

			.result.error {
				background: #f8d7da;
				color: #721c24;
				border: 1px solid #f5c6cb;
			}

			.loading {
				display: inline-block;
				width: 20px;
				height: 20px;
				border: 3px solid rgba(255, 255, 255, 0.3);
				border-radius: 50%;
				border-top-color: #fff;
				animation: spin 1s ease-in-out infinite;
			}

			@keyframes spin {
				to {
					transform: rotate(360deg);
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>ğŸ¯ ä»£ç†ç»‘å®šç³»ç»Ÿ</h1>
			<p class="subtitle">è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯å®Œæˆç»‘å®š</p>

			<form id="bindForm">
				<div class="form-group">
					<label for="telegramId">Telegram ID</label>
					<input type="text" id="telegramId" placeholder="ä¾‹å¦‚: 123456789" required />
				</div>

				<div class="form-group">
					<label for="address">æ³¢åœºåœ°å€</label>
					<input type="text" id="address" placeholder="ä¾‹å¦‚: TXxx...xxx" required />
				</div>

				<div class="form-group">
					<label for="serviceAccount">å®¢æœè´¦å·</label>
					<input type="text" id="serviceAccount" placeholder="ä¾‹å¦‚: agent001" required />
				</div>

				<button type="submit" id="submitBtn">
					<span id="btnText">æäº¤ç»‘å®š</span>
				</button>
			</form>

			<div id="result" class="result"></div>
		</div>

		<script>
			// âš ï¸ é‡è¦ï¼šé…ç½® API åœ°å€
			//
			// é€‰é¡¹ 1ï¼ˆå›½é™…ç”¨æˆ·ï¼‰ï¼šç›´æ¥ä½¿ç”¨ Google Apps Script URL
			// const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxySAW3jDQcRrZWsD27IZZs2tzD6PJyDyyQlAFM0K035Zq2oZtRXhYsGLHqGspubdH5/exec'
			//
			// é€‰é¡¹ 2ï¼ˆä¸­å›½å¤§é™†ç”¨æˆ·ï¼‰ï¼šä½¿ç”¨ Cloudflare Worker ä»£ç†
			// 1. å°† cloudflare-worker.js éƒ¨ç½²åˆ° Cloudflare Workers
			// 2. è·å– Worker URLï¼ˆä¾‹å¦‚ï¼šhttps://gas-proxy.your-name.workers.devï¼‰
			// 3. å–æ¶ˆä¸‹é¢è¿™è¡Œçš„æ³¨é‡Šå¹¶æ›¿æ¢ä¸ºä½ çš„ Worker URL
			const WEB_APP_URL = 'https://vipusdt.dpdns.org/' // ğŸ‘ˆ æ›¿æ¢ä¸ºä½ çš„ Cloudflare Worker URL

			// ğŸ” å®‰å…¨é…ç½®ï¼šAPI å¯†é’¥(å¿…é¡»ä¸ Cloudflare Worker ä¸­çš„ SECRET_KEY ä¸€è‡´)
			const SECRET_API_KEY = '5bZk4n9czeodcjtmnPlgWsvS3gBX47hq8pqLvHKXEOc=' // ğŸ” ä¸ Worker ç›¸åŒçš„å¯†é’¥

			const form = document.getElementById('bindForm')
			const resultDiv = document.getElementById('result')
			const submitBtn = document.getElementById('submitBtn')
			const btnText = document.getElementById('btnText')

			form.addEventListener('submit', async (e) => {
				e.preventDefault()

				// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
				submitBtn.disabled = true
				btnText.innerHTML = '<span class="loading"></span> æäº¤ä¸­...'
				resultDiv.style.display = 'none'

				const data = {
					telegramId: document.getElementById('telegramId').value,
					address: document.getElementById('address').value,
					serviceAccount: document.getElementById('serviceAccount').value,
				}

				try {
					// å‘é€ POST è¯·æ±‚ï¼ˆä½¿ç”¨ redirect æ¨¡å¼ä»¥è·å–æœ€ç»ˆå“åº”ï¼‰
					const response = await fetch(WEB_APP_URL, {
						method: 'POST',
						redirect: 'follow', // è·Ÿéšé‡å®šå‘
						headers: {
							'Content-Type': 'application/json',
							'X-API-Key': SECRET_API_KEY, // ğŸ” æ·»åŠ  API å¯†é’¥
						},
						body: JSON.stringify(data),
					})

					// è¯»å–å“åº”
					const result = await response.json()

					if (result.success) {
						showResult('success', result.message)
						form.reset()
					} else {
						showResult('error', result.message || 'æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•')
					}
				} catch (error) {
					console.error('è¯·æ±‚é”™è¯¯:', error)
					showResult('error', 'âŒ ç½‘ç»œé”™è¯¯: ' + error.message)
				} finally {
					// æ¢å¤æŒ‰é’®çŠ¶æ€
					submitBtn.disabled = false
					btnText.textContent = 'æäº¤ç»‘å®š'
				}
			})

			function showResult(type, message) {
				resultDiv.className = 'result ' + type
				resultDiv.textContent = message
				resultDiv.style.display = 'block'

				// 5ç§’åè‡ªåŠ¨éšè—
				setTimeout(() => {
					resultDiv.style.display = 'none'
				}, 5000)
			}
		</script>
	</body>
</html>
